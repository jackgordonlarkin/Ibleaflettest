
<!DOCTYPE html>
<html lang="en">
<head>
 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>    <meta http-equiv="X-UA-Compatible" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content= "Jack Larkin">
    <title>Map testing</title>
    <link rel="icon" href="IB.ico">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/stylish-portfolio.css" rel="stylesheet">
    <script src = "papaparse.min.js"></script>
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Zoomy Map</title>
    <style>
      html,
      body,
      #map {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 14px;
        color: #323232;
       z-index: 0
      }
        #menu {
position: fixed;
background: rgba(255, 255, 255, 0.5);
padding: 2px;
top: 3.5%;
left: 0;
width: 422px;
z-index: 111;
}
          #basemaps-wrapper {
        position: absolute;
        top: 20px;
        left: 50px;
        background: rgba(255, 255, 255, 0);
      }
      #basemaps {
        font-size: 16px;
        padding: 4px 8px;
      }

}
</style>
<script src=https://unpkg.com/maplibre-gl@2.1.9/dist/maplibre-gl.js></script>
    <link href=https://unpkg.com/maplibre-gl@2.1.9/dist/maplibre-gl.css rel="stylesheet" />
<script src ="https://unpkg.com/mapbox-gl-esri-sources/dist/mapbox-gl-esri-services"></script>
  </head>

  <body>
<a id="menu-toggle" href="#" class="btn btn-dark btn-lg toggle"><i class="fa fa-bars"></i></a>
    <nav id="sidebar-wrapper">
        <ul class="sidebar-nav">
            <a id="menu-close" href="#" class="btn btn-light btn-lg pull-right toggle"><i class="fa fa-times"></i></a>
            <li class="sidebar-brand">
                <a href="#top" onclick=$("#menu-close").click();><b>Map Test</b></a>
            </li>
            <li>
                <b><a href="index.html" onclick=$("#menu-close").click();>Zooming through layers</a></b>
            </li>
            <li>
                <a href="#map" onclick=$("#menu-close").click();>Transparency</a>
            </li>
           
        </ul>
    </nav>
<div id="custom-nav-container"></div>

<div id="map"></div>
          <div id="basemaps-wrapper">

      <select id="basemaps">
          <option value="ArcGIS:Community">ArcGIS Community</option>
          <option value="ArcGIS:Imagery">ArcGIS Imagery</option>
  <option value="ArcGIS:Imagery:Standard">ArcGIS Imagery Standard</option>
  <option value="ArcGIS:Imagery:Labels">ArcGIS Imagery Labels</option>
  <option value="ArcGIS:LightGray">ArcGIS LightGray</option>
  <option value="ArcGIS:LightGray:Base">ArcGIS LightGray Base</option>
  <option value="ArcGIS:LightGray:Labels">ArcGIS LightGray Labels</option>
  <option value="ArcGIS:DarkGray">ArcGIS DarkGray</option>
  <option value="ArcGIS:DarkGray:Base">ArcGIS DarkGray Base</option>
  <option value="ArcGIS:DarkGray:Labels">ArcGIS DarkGray Labels</option>
  <option value="ArcGIS:Navigation">ArcGIS Navigation</option>
  <option value="ArcGIS:NavigationNight">ArcGIS NavigationNight</option>
  <option value="ArcGIS:Streets">ArcGIS Streets</option>
  <option value="ArcGIS:StreetsNight">ArcGIS StreetsNight</option>
  <option value="ArcGIS:StreetsRelief">ArcGIS StreetsRelief</option>
  <option value="ArcGIS:StreetsRelief:Base">ArcGIS StreetsRelief Base</option>
  <option value="ArcGIS:Topographic">ArcGIS Topographic</option>
  <option value="ArcGIS:Topographic:Base">ArcGIS Topographic Base</option>
  <option value="ArcGIS:Oceans">ArcGIS Oceans</option>
  <option value="ArcGIS:Oceans:Base">ArcGIS Oceans Base</option>
  <option value="ArcGIS:Oceans:Labels">ArcGIS Oceans Labels</option>
  <option value="OSM:Standard">OSM Standard</option>
  <option value="OSM:StandardRelief">OSM StandardRelief</option>
  <option value="OSM:StandardRelief:Base">OSM StandardRelief Base</option>
  <option value="OSM:Streets">OSM Streets</option>
  <option value="OSM:StreetsRelief">OSM StreetsRelief</option>
  <option value="OSM:StreetsRelief:Base">OSM StreetsRelief Base</option>
  <option value="OSM:LightGray">OSM LightGray</option>
  <option value="OSM:LightGray:Base">OSM LightGray Base</option>
  <option value="OSM:LightGray:Labels">OSM LightGray Labels</option>
  <option value="OSM:DarkGray">OSM DarkGray</option>
  <option value="OSM-DarkGray:Base">OSM DarkGray Base</option>
  <option value="OSM-DarkGray:Labels">OSM DarkGray Labels</option>
  <option value="ArcGIS:Terrain">ArcGIS Terrain</option>
  <option value="ArcGIS:Terrain:Base">ArcGIS Terrain Base</option>
  <option value="ArcGIS:Terrain:Detail">ArcGIS Terrain Detail</option>
  <option value="ArcGIS:Hillshade:Light">Hillshade</option>
  <option value= "6976148c11bd497d8624206f9ee03e30">Forest and Parks</option>
  <option value= "659e7c1b1e374f6c8a89eefe17b23380">Outdoor</option>
  <option value= "ArcGIS:ColoredPencil">Silly Pencil Map</option>
<option value= "ArcGIS:Nova">Silly Future Map</option>
<option value= "ArcGIS:Newspaper">Silly Newspaper Map</option>
      </select>
    </div>
    <script>
function getMarkerOpacity(zoom) {
  if (zoom < 5) {
    return 1;
  } else if (zoom > 21) {
    return 0.1;
  } else {
    return 1 - (zoom - 5) / 16;
  }
};
function getFillOpacity(zoom) {
  if (zoom <= 6) {
    return 0.6;
  } else if (zoom >= 15) {
    return 0.2;
  } else {
    // Calculate the fill opacity on a linear scale between 0.6 and 0.2
    return 0.6 - ((zoom - 6) / 11) * 0.4;
  }
};
     const apiKey = "AAPK01d3c973b91841e99191a7cb96374713ppA1XdSa_FzdBTpO68P75mXoB6ZHH8JMoore66SKKVDlcN39rMGtvZS59A1c8rEU";

// Get the basemaps dropdown element
const basemapsDropdown = document.getElementById('basemaps');

// Add an event listener to the basemaps dropdown
basemapsDropdown.addEventListener('change', () => {
  // Get the selected basemap value
  const basemapEnum = basemapsDropdown.value;
  
  // Update the map style with the selected basemap

  map.setStyle(`https://basemaps-api.arcgis.com/arcgis/rest/services/styles/${basemapEnum}?type=style&token=${apiKey}`, {
    // This function runs once the style has finished loading
    onLoad: function () {
      // Get the ID of the first layer in the style
      const layers = map.getStyle().layers;
      const firstLayerId = layers[0].id;

      // Set the opacity of the first layer in the style
      map.setPaintProperty(firstLayerId, "raster-opacity", 0.5);
    }
  });
 
  map.once("styledata", () => {
  // This code runs once the base style has finished loading.

  map.addSource("NSWtopo", {
    type: "raster",
    tiles: [
      "https://maps.six.nsw.gov.au/arcgis/rest/services/public/NSW_Topo_Map/MapServer/tile/{z}/{y}/{x}"],
    tileSize : 100
  });

  // Find the first non-background layer in order to add our raster layer before it.
  const layers = map.getStyle().layers;
  const bottomLayer = layers.find((layer) => layer.type !== "background");

  map.addLayer(
    {
      id: "NSW",
      type: "raster",
      source: "NSWtopo"
    },

    bottomLayer.id

  );
   var zoom = map.getZoom();
   layers.forEach((layer) => {
          if (layer.id !== "NSW" && layer.type === "fill" && !layer.id.match(/(Marine area)/)) {
            map.setPaintProperty(layer.id, "fill-opacity", getFillOpacity(zoom));
          } else if (layer.id !== "NSW" && layer.type === "line") {
            map.setPaintProperty(layer.id, "line-opacity", getMarkerOpacity(zoom));
          } else if (layer.id !== "NSW" && layer.type === "symbol") {
            map.setPaintProperty(layer.id, "icon-opacity", getMarkerOpacity(zoom));
          }
        });
    

  });
});


// Create the map with the initial basemap
let basemapEnum = basemapsDropdown.value;
const map = new maplibregl.Map({
  container: "map", // the id of the div element
  style: `https://basemaps-api.arcgis.com/arcgis/rest/services/styles/${basemapEnum}?type=style&token=${apiKey}`,
  zoom: 12, // starting zoom
  center: [149.131,-35.27] // starting location [longitude, latitude]
});

// Add navigation control to the map
var nav = new maplibregl.NavigationControl({
    visualizePitch: true,
    showZoom: true,
    showCompass: true
  });
map.addControl(nav, 'top-left');
  map.once("load", () => {
  // This code runs once the base style has finished loading.

  map.addSource("NSWtopo", {
    type: "raster",
    tiles: [
      "https://maps.six.nsw.gov.au/arcgis/rest/services/public/NSW_Topo_Map/MapServer/tile/{z}/{y}/{x}"],
    tileSize : 100
  });

  // Find the first non-background layer in order to add our raster layer before it.
  const layers = map.getStyle().layers;
  const bottomLayer = layers.find((layer) => layer.type !== "background");

  map.addLayer(
    {
      id: "NSW",
      type: "raster",
      source: "NSWtopo"
    },

    bottomLayer.id

  );
  map.on("zoomend", () => {
    var zoom = map.getZoom();
    layers.forEach((layer) => {
          if (layer.id !== "NSW" && layer.type === "fill" && !layer.id.match(/(Marine area)/)) {
            map.setPaintProperty(layer.id, "fill-opacity", getFillOpacity(zoom));
          } else if (layer.id !== "NSW" && layer.type === "line") {
            map.setPaintProperty(layer.id, "line-opacity", getMarkerOpacity(zoom));
          } else if (layer.id !== "NSW" && layer.type === "symbol") {
            map.setPaintProperty(layer.id, "icon-opacity", getMarkerOpacity(zoom));
          }
        });
      });
   var zoom = map.getZoom();
   layers.forEach((layer) => {
          if (layer.id !== "NSW" && layer.type === "fill" && !layer.id.match(/(Marine area)/)) {
            map.setPaintProperty(layer.id, "fill-opacity", getFillOpacity(zoom));
          } else if (layer.id !== "NSW" && layer.type === "line") {
            map.setPaintProperty(layer.id, "line-opacity", getMarkerOpacity(zoom));
          } else if (layer.id !== "NSW" && layer.type === "symbol") {
            map.setPaintProperty(layer.id, "icon-opacity", getMarkerOpacity(zoom));
          }
        });
 
      
    

});



    </script>
    <script>
$("#menu-close").click(function(e){e.preventDefault();$("#sidebar-wrapper").toggleClass("active")});$("#menu-toggle").click(function(e){e.preventDefault();$("#sidebar-wrapper").toggleClass("active")});$(function(){$('a[href*=#]:not([href=#],[data-toggle],[data-target],[data-slide])').click(function(){if(location.pathname.replace(/^\//,'')==this.pathname.replace(/^\//,'')||location.hostname==this.hostname){var target=$(this.hash);target=target.length?target:$('[name='+this.hash.slice(1)+']');if(target.length){$('html,body').animate({scrollTop:target.offset().top},1000);return false}}})});var fixed=false;$(document).scroll(function(){if($(this).scrollTop()>250){if(!fixed){fixed=true;$('#to-top').show("slow",function(){$('#to-top').css({position:'fixed',display:'block'})})}}else{if(fixed){fixed=false;$('#to-top').hide("slow",function(){$('#to-top').css({display:'none'})})}}});
    </script>
  </body>

</html>